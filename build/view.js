(()=>{class t{constructor(t){this.container=t,this.button=t.querySelector(".raffle-button"),this.numberElement=t.querySelector(".number-result"),this.canvas=t.querySelector(".celebration-canvas"),this.ctx=this.canvas?this.canvas.getContext("2d"):null;const e=parseInt(t.getAttribute("data-starting-number")||"1",10),i=parseInt(t.getAttribute("data-ending-number")||"100",10),a=parseInt(t.getAttribute("data-raffle-duration")||"5",10);this.startingNumber=isNaN(e)||e<-999999||e>999999?1:e,this.endingNumber=isNaN(i)||i<-999999||i>999999?100:i,this.raffleDuration=isNaN(a)||a<1||a>60?5:a,this.endingNumber<=this.startingNumber&&(this.endingNumber=this.startingNumber+1),this.fullscreen="true"===t.getAttribute("data-fullscreen");const s=t.getAttribute("data-animation-type")||"fireworks";this.animationType=["fireworks","confetti","stars","balloons"].includes(s)?s:"fireworks",this.particles=[],this.animationFrame=null,this.celebrationActive=!1,this.keydownHandler=null,this.init()}init(){this.button&&this.button.addEventListener("click",()=>this.startRaffle()),this.canvas&&(this.resizeCanvas(),window.addEventListener("resize",()=>this.resizeCanvas()))}resizeCanvas(){this.canvas&&(this.canvas.width=this.container.offsetWidth,this.canvas.height=this.container.offsetHeight)}startRaffle(){if(!this.numberElement||!this.button)return;this.stopCelebration(),this.fullscreen&&(this.container.classList.add("fullscreen-active"),this.resizeCanvas()),this.button.disabled=!0,this.button.classList.add("drawing"),this.numberElement.classList.remove("revealed"),this.numberElement.classList.add("rolling");const t=1e3*this.raffleDuration/100;let e=0;const i=setInterval(()=>{const a=Math.floor(Math.random()*(this.endingNumber-this.startingNumber+1))+this.startingNumber;this.numberElement.textContent=a,e++,e>=t&&(clearInterval(i),this.revealResult())},100)}revealResult(){const t=Math.floor(Math.random()*(this.endingNumber-this.startingNumber+1))+this.startingNumber;this.numberElement.textContent=t,this.numberElement.classList.remove("rolling"),this.numberElement.classList.add("revealed"),this.button&&(this.button.disabled=!1,this.button.classList.remove("drawing")),this.startCelebration(),this.addKeyListener()}addKeyListener(){this.keydownHandler&&document.removeEventListener("keydown",this.keydownHandler),this.keydownHandler=t=>{this.celebrationActive&&(t.preventDefault(),this.stopCelebration(),this.fullscreen&&this.container.classList.contains("fullscreen-active")&&(this.container.classList.remove("fullscreen-active"),this.resizeCanvas()),document.removeEventListener("keydown",this.keydownHandler),this.keydownHandler=null)},document.addEventListener("keydown",this.keydownHandler)}stopCelebration(){this.animationFrame&&(cancelAnimationFrame(this.animationFrame),this.animationFrame=null),this.celebrationActive=!1,this.particles=[],this.canvas&&this.ctx&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.canvas.classList.remove("active"))}startCelebration(){if(!this.canvas||!this.ctx)return;this.canvas.classList.add("active"),this.particles=[],this.celebrationActive=!0;const t=()=>{if(this.celebrationActive){switch(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.animationType){case"fireworks":Math.random()<.1&&this.createFirework();break;case"confetti":Math.random()<.3&&this.createConfetti();break;case"stars":Math.random()<.2&&this.createStar();break;case"balloons":Math.random()<.15&&this.createBalloon()}this.updateParticles(),this.drawParticles(),this.animationFrame=requestAnimationFrame(t)}};t()}createFirework(){const t=Math.random()*this.canvas.width,e=Math.random()*(.5*this.canvas.height),i=`hsl(${360*Math.random()}, 100%, 60%)`;for(let a=0;a<50;a++){const s=2*Math.PI*a/50,n=2+3*Math.random();this.particles.push({type:"firework",x:t,y:e,vx:Math.cos(s)*n,vy:Math.sin(s)*n,color:i,life:1,size:2+3*Math.random()})}}createConfetti(){const t=Math.random()*this.canvas.width,e=["#ff6b6b","#4ecdc4","#ffe66d","#a8dadc","#f1faee"],i=e[Math.floor(Math.random()*e.length)];this.particles.push({type:"confetti",x:t,y:-20,vx:2*(Math.random()-.5),vy:2*Math.random()+1,rotation:360*Math.random(),rotationSpeed:10*(Math.random()-.5),color:i,life:1,size:5+5*Math.random(),shape:Math.random()>.5?"square":"rectangle"})}createStar(){const t=Math.random()*this.canvas.width,e=Math.random()*this.canvas.height;this.particles.push({type:"star",x:t,y:e,vx:0,vy:0,scale:0,color:"#ffd700",life:1,size:20+20*Math.random(),points:5})}createBalloon(){const t=Math.random()*this.canvas.width,e=this.canvas.height+50,i=["#ff6b6b","#4ecdc4","#ffe66d","#a8dadc","#f1faee"],a=i[Math.floor(Math.random()*i.length)];this.particles.push({type:"balloon",x:t,y:e,vx:.5*(Math.random()-.5),vy:-(1+1*Math.random()),oscillation:Math.random()*Math.PI*2,color:a,life:1,size:20+15*Math.random()})}updateParticles(){this.particles=this.particles.filter(t=>{switch(t.type){case"firework":t.x+=t.vx,t.y+=t.vy,t.vy+=.1,t.life-=.01;break;case"confetti":t.x+=t.vx,t.y+=t.vy,t.rotation+=t.rotationSpeed,t.vy+=.1,t.y>this.canvas.height&&(t.life=0);break;case"star":t.scale<1?t.scale+=.05:t.life-=.02;break;case"balloon":t.x+=t.vx+.5*Math.sin(t.oscillation),t.y+=t.vy,t.oscillation+=.1,t.y<-50&&(t.life=0)}return t.life>0})}drawParticles(){this.particles.forEach(t=>{switch(this.ctx.save(),this.ctx.globalAlpha=t.life,t.type){case"firework":this.ctx.fillStyle=t.color,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.size,0,2*Math.PI),this.ctx.fill();break;case"confetti":this.ctx.translate(t.x,t.y),this.ctx.rotate(t.rotation*Math.PI/180),this.ctx.fillStyle=t.color,"square"===t.shape?this.ctx.fillRect(-t.size/2,-t.size/2,t.size,t.size):this.ctx.fillRect(-t.size/2,-t.size/4,t.size,t.size/2);break;case"star":this.ctx.translate(t.x,t.y),this.ctx.scale(t.scale,t.scale),this.drawStar(0,0,t.points,t.size,t.size/2,t.color);break;case"balloon":this.drawBalloon(t.x,t.y,t.size,t.color)}this.ctx.restore()})}drawStar(t,e,i,a,s,n){this.ctx.fillStyle=n,this.ctx.strokeStyle=n,this.ctx.lineWidth=2,this.ctx.beginPath();for(let n=0;n<2*i;n++){const r=n%2==0?a:s,h=Math.PI*n/i-Math.PI/2,o=t+Math.cos(h)*r,c=e+Math.sin(h)*r;0===n?this.ctx.moveTo(o,c):this.ctx.lineTo(o,c)}this.ctx.closePath(),this.ctx.fill(),this.ctx.stroke()}drawBalloon(t,e,i,a){this.ctx.fillStyle=a,this.ctx.beginPath(),this.ctx.ellipse(t,e,.6*i,i,0,0,2*Math.PI),this.ctx.fill(),this.ctx.strokeStyle=a,this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.moveTo(t,e+i),this.ctx.quadraticCurveTo(t+5,e+i+10,t,e+i+20),this.ctx.stroke(),this.ctx.fillStyle="rgba(255, 255, 255, 0.3)",this.ctx.beginPath(),this.ctx.ellipse(t-.2*i,e-.3*i,.15*i,.25*i,-.3,0,2*Math.PI),this.ctx.fill()}}document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".raffle-container").forEach(e=>{new t(e)})})})();